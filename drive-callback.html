<!doctype html>
<meta charset="utf-8" />
<title>Drive OAuth Redirect</title>
<style>
  body { font:14px system-ui, -apple-system, Segoe UI, Roboto, Arial; padding:24px; }
</style>
<script>
(function(){
  var token = null;
  try {
    var h = new URLSearchParams(location.hash.slice(1));
    token = h.get('access_token') || null;
  } catch(e) {}

  function sendToken(){
    try { if (window.opener) window.opener.postMessage({ type:'drive-token', accessToken: token }, '*'); } catch(_){}
    try { if (window.opener && window.opener.parent) window.opener.parent.postMessage({ type:'drive-token', accessToken: token }, '*'); } catch(_){}
    try { if (window.opener && window.opener.top) window.opener.top.postMessage({ type:'drive-token', accessToken: token }, '*'); } catch(_){}
  }

  if (token) {
    // blast a few times in case opener is still loading / sandboxed
    sendToken();
    var tries = 0;
    var t = setInterval(function(){
      tries++;
      sendToken();
      if (tries > 15) { clearInterval(t); try{ window.close(); }catch(_){ } }
    }, 300);
  }
})();
</script>
<body>You can close this window.</body>
